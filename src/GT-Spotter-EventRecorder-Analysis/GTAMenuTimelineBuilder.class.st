Class {
	#name : #GTAMenuTimelineBuilder,
	#superclass : #Object,
	#instVars : [
		'timelineBuilder',
		'menuBuilder'
	],
	#category : #'GT-Spotter-EventRecorder-Analysis-Roassal-Timeline'
}

{ #category : #building }
GTAMenuTimelineBuilder >> build [
	self renderIn: timelineBuilder view.
]

{ #category : #'event handling' }
GTAMenuTimelineBuilder >> divingUsage [
	self numberOfOccurrences: #divesIn inform: 'No dives-in.'

]

{ #category : #'event handling' }
GTAMenuTimelineBuilder >> highlightComposedQueries [
	self highlightSessionsWithEvents: [ :eachEvent | 
		(eachEvent isSearchFinished and: [ (eachEvent currentQuerySpecials reject: [ :b | b = true ]) size > 1 ]) 
			and: [ eachEvent notEmptyCategories isEmpty ] ]
]

{ #category : #'event handling' }
GTAMenuTimelineBuilder >> highlightPharo5Users [
	self highlightSessionsWithEvents: [ :eachEvent | 
		eachEvent latestUpdate >= 50000 ]
]

{ #category : #'event handling' }
GTAMenuTimelineBuilder >> highlightSessionsWithEvents: aBlock [
	timelineBuilder elements do: [ :eachElement | | color |
		(eachElement model anyEventSatisfy: aBlock)
			ifTrue: [ color := Color red ]
			ifFalse: [ color := Color white ].
		eachElement trachelShape 
			color: color;
			strokePaint: (Color black alpha: 0.4) ].
	timelineBuilder view signalUpdate
]

{ #category : #initialization }
GTAMenuTimelineBuilder >> initialize [
	super initialize.
	menuBuilder := RTMenuBuilder new.
]

{ #category : #'event handling' }
GTAMenuTimelineBuilder >> keywordUsage [
	self numberOfOccurrences: #specialKeywords inform: 'No keywords.'

]

{ #category : #'event handling' }
GTAMenuTimelineBuilder >> numberOfOccurrences: aSymbol inform: aNoOccurrencesString [
	| elements keywords normalizer maxKeywords |
	elements := timelineBuilder elements.
	keywords := elements collect: [ :e | e -> (e model perform: aSymbol) size ].
	maxKeywords := keywords max: [ :assoc | assoc value ].
	maxKeywords = 0 ifTrue: [ 
		self inform: aNoOccurrencesString.
		^ self ].
	normalizer := RTGrayLinearColor new.
	normalizer command: #yourself; scope: (0 to: maxKeywords).
	elements do: [ :element | | elementKeywords |
		elementKeywords := keywords detect: [ :assoc | assoc key == element ].
		element trachelShape 
			color: (normalizer rtValue: elementKeywords value);
			strokePaint: (Color black alpha: 0.4) ].
	timelineBuilder view signalUpdate
]

{ #category : #'event handling' }
GTAMenuTimelineBuilder >> numberOfSessions [
	self numberOfOccurrences: #yourself inform: 'There is not any session.'

]

{ #category : #hooks }
GTAMenuTimelineBuilder >> renderIn: aView [
	menuBuilder view: aView.
	menuBuilder menu: 'Feature usage' submenu: 'Number of Sessions' callback: [ self numberOfSessions ].
	menuBuilder menu: 'Feature usage' submenu: 'Keyword Usage' callback: [ self keywordUsage ].
	menuBuilder menu: 'Feature usage' submenu: 'Diving Usage' callback: [ self divingUsage ].
	menuBuilder menu: 'Feature usage' submenu: 'Composed Queries Usage' callback: [ self highlightComposedQueries ].
	menuBuilder menu: 'Feature usage' submenu: 'Pharo 5 Images' callback: [ self highlightPharo5Users ].

	menuBuilder menu: 'Data cleaning' submenu: 'Unknown items' callback: [ self unknownItems ].

	menuBuilder menu: 'Clean' callback: [ self unspeciedFeature ].

]

{ #category : #accessing }
GTAMenuTimelineBuilder >> timelineBuilder [
	^ timelineBuilder
]

{ #category : #accessing }
GTAMenuTimelineBuilder >> timelineBuilder: anObject [
	timelineBuilder := anObject
]

{ #category : #'event handling' }
GTAMenuTimelineBuilder >> unknownItems [
	self numberOfOccurrences: #unknownNames inform: 'No unknown names.'
]

{ #category : #'event handling' }
GTAMenuTimelineBuilder >> unspeciedFeature [
	| elements normalizer  |
	elements := timelineBuilder elements.
	normalizer := RTMultiLinearColorForIdentity new 
							objects: elements;
							yourself.
	elements do: [ :element |
		element trachelShape 
			color: (normalizer rtValue: element);
			strokePaint: Color transparent ].
	timelineBuilder view signalUpdate
]
